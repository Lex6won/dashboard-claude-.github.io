<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²½ê¸°ë„ AI ë“±ë¡ì œ ì„œë¹„ìŠ¤ í˜„í™©</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }
        .small-chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        .file-upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 0.5rem;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
        }
        .file-upload-area:hover {
            border-color: #6366f1;
            background-color: #f8fafc;
        }
        .file-upload-area.dragover {
            border-color: #6366f1;
            background-color: #eef2ff;
        }
    </style>
</head>
<body>
    <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
        <!-- í—¤ë” -->
        <div class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="text-center">
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">ê²½ê¸°ë„ AI ë“±ë¡ì œ ì„œë¹„ìŠ¤ í˜„í™©</h1>
                    <p class="text-gray-600">ë™ì  ë°ì´í„° ë¶„ì„ ëŒ€ì‹œë³´ë“œ</p>
                </div>
            </div>
        </div>

        <!-- íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ -->
        <div class="max-w-7xl mx-auto px-6 py-6" id="uploadSection">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Excel íŒŒì¼ ì—…ë¡œë“œ</h2>
                <div class="file-upload-area" id="uploadArea">
                    <div class="mb-4">
                        <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                            <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </div>
                    <div class="text-lg font-medium text-gray-900 mb-2">Excel íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</div>
                    <div class="text-sm text-gray-500 mb-4">
                        Excel íŒŒì¼(.xlsx, .xls)ì„ ë“œë˜ê·¸ ì•¤ ë“œë¡­í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”
                    </div>
                    <input type="file" id="fileInput" accept=".xlsx,.xls" class="hidden">
                    <button onclick="document.getElementById('fileInput').click()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition-colors">
                        íŒŒì¼ ì„ íƒ
                    </button>
                </div>
                <div id="fileName" class="mt-4 text-sm text-green-600 hidden"></div>
                <div id="loadingIndicator" class="mt-4 text-center hidden">
                    <div class="inline-flex items-center px-4 py-2 font-semibold leading-6 text-sm shadow rounded-md text-white bg-blue-500 transition ease-in-out duration-150">
                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        ë°ì´í„° ì²˜ë¦¬ ì¤‘...
                    </div>
                </div>
            </div>
        </div>

        <!-- ëŒ€ì‹œë³´ë“œ ì½˜í…ì¸  (ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€) -->
        <div id="dashboardContent" class="hidden">
            <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
            <div class="bg-white border-b">
                <div class="max-w-7xl mx-auto px-6">
                    <div class="flex space-x-8 overflow-x-auto">
                        <button onclick="setActiveTab('overview')" class="tab-button flex items-center space-x-2 py-4 px-2 border-b-2 whitespace-nowrap transition-colors border-blue-500 text-blue-600 font-medium" data-tab="overview">
                            <span>ğŸ“Š</span>
                            <span>ì „ì²´ í˜„í™©</span>
                        </button>
                        <button onclick="setActiveTab('category')" class="tab-button flex items-center space-x-2 py-4 px-2 border-b-2 whitespace-nowrap transition-colors border-transparent text-gray-500 hover:text-gray-700" data-tab="category">
                            <span>ğŸ“ˆ</span>
                            <span>ë¶„ì•¼ë³„ ë¶„ì„</span>
                        </button>
                        <button onclick="setActiveTab('adoption')" class="tab-button flex items-center space-x-2 py-4 px-2 border-b-2 whitespace-nowrap transition-colors border-transparent text-gray-500 hover:text-gray-700" data-tab="adoption">
                            <span>ğŸ›ï¸</span>
                            <span>ë„ì… ì§€ìì²´</span>
                        </button>
                        <button onclick="setActiveTab('operating')" class="tab-button flex items-center space-x-2 py-4 px-2 border-b-2 whitespace-nowrap transition-colors border-transparent text-gray-500 hover:text-gray-700" data-tab="operating">
                            <span>âš™ï¸</span>
                            <span>ìš´ì˜ ê¸°ê´€</span>
                        </button>
                        <button onclick="setActiveTab('timeline')" class="tab-button flex items-center space-x-2 py-4 px-2 border-b-2 whitespace-nowrap transition-colors border-transparent text-gray-500 hover:text-gray-700" data-tab="timeline">
                            <span>ğŸ“…</span>
                            <span>ì‹œê³„ì—´ ë¶„ì„</span>
                        </button>
                        <button onclick="setActiveTab('target')" class="tab-button flex items-center space-x-2 py-4 px-2 border-b-2 whitespace-nowrap transition-colors border-transparent text-gray-500 hover:text-gray-700" data-tab="target">
                            <span>ğŸ‘¥</span>
                            <span>ì„œë¹„ìŠ¤ ëŒ€ìƒ</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- ì½˜í…ì¸  ì˜ì—­ -->
            <div class="max-w-7xl mx-auto px-6 py-6">
                <!-- ì „ì²´ í˜„í™© íƒ­ -->
                <div id="overview-content" class="tab-content space-y-6">
                    <!-- ì£¼ìš” ì§€í‘œ ì¹´ë“œ -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-lg font-bold text-gray-800 mb-4">í•µì‹¬ ì§€í‘œ</h2>
                        <div class="grid grid-cols-2 md:grid-cols-5 gap-4" id="keyMetrics">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                        </div>
                    </div>

                    <!-- ì£¼ìš” ì¸ì‚¬ì´íŠ¸ -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">ì£¼ìš” ì¸ì‚¬ì´íŠ¸</h2>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4" id="insights">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                        </div>
                    </div>

                    <!-- ìš”ì•½ ì°¨íŠ¸ -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">í™œìš©ë¶„ì•¼ë³„ í˜„í™©</h2>
                            <div class="small-chart-container">
                                <canvas id="categoryChart"></canvas>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">ë„ì… ì—°ë„ë³„ ì¶”ì´</h2>
                            <div class="small-chart-container">
                                <canvas id="yearChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ë¶„ì•¼ë³„ ë¶„ì„ íƒ­ -->
                <div id="category-content" class="tab-content space-y-6" style="display: none;">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">í™œìš©ë¶„ì•¼ë³„ ìƒì„¸ í˜„í™©</h2>
                            <div class="chart-container">
                                <canvas id="categoryDetailChart"></canvas>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">AI ì„œë¹„ìŠ¤ ìœ í˜•ë³„ ë¶„ì„</h2>
                            <div class="chart-container">
                                <canvas id="aiTypeChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- ë¶„ì•¼ë³„ ìƒì„¸ í…Œì´ë¸” -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">ë¶„ì•¼ë³„ ìƒì„¸ ë¶„í¬</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h3 class="font-semibold text-gray-700 mb-3">í™œìš©ë¶„ì•¼ë³„</h3>
                                <div class="space-y-2" id="categoryTable"></div>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-700 mb-3">AI ìœ í˜•ë³„</h3>
                                <div class="space-y-2" id="aiTypeTable"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ë„ì… ì§€ìì²´ íƒ­ -->
                <div id="adoption-content" class="tab-content space-y-6" style="display: none;">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">ë„ì… ì§€ìì²´ë³„ í˜„í™© (ìƒìœ„ 10ê°œ)</h2>
                            <div class="chart-container">
                                <canvas id="adoptionChart"></canvas>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">ì§€ìì²´ë³„ ë„ì… ë¶„ì•¼ í˜„í™©</h2>
                            <div class="chart-container">
                                <canvas id="adoptionCategoryChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- ë„ì… ì§€ìì²´ ìƒì„¸ í˜„í™© í…Œì´ë¸” -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">ì „ì²´ ë„ì… ì§€ìì²´ í˜„í™©</h2>
                            <div class="max-h-96 overflow-y-auto">
                                <table class="w-full text-sm" id="adoptionTable">
                                    <thead class="sticky top-0 bg-gray-50">
                                        <tr class="border-b border-gray-200">
                                            <th class="text-left py-2 px-3">ìˆœìœ„</th>
                                            <th class="text-left py-2 px-3">ì§€ìì²´ëª…</th>
                                            <th class="text-right py-2 px-3">ë„ì… ì„œë¹„ìŠ¤ ìˆ˜</th>
                                            <th class="text-right py-2 px-3">ë¹„ìœ¨</th>
                                        </tr>
                                    </thead>
                                    <tbody id="adoptionTableBody"></tbody>
                                </table>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">ì§€ìì²´ë³„ ë„ì… ë¶„ì•¼ ë¶„ì„</h2>
                            <div class="max-h-96 overflow-y-auto">
                                <table class="w-full text-xs" id="adoptionDetailTable">
                                    <thead class="sticky top-0 bg-gray-50">
                                        <tr class="border-b border-gray-200">
                                            <th class="text-left py-2 px-2">ì§€ìì²´ëª…</th>
                                            <th class="text-center py-2 px-1">ë³µì§€</th>
                                            <th class="text-center py-2 px-1">í–‰ì •</th>
                                            <th class="text-center py-2 px-1">êµí†µ</th>
                                            <th class="text-center py-2 px-1">ì˜ë£Œ</th>
                                            <th class="text-center py-2 px-1">êµìœ¡</th>
                                            <th class="text-center py-2 px-1">ê¸°íƒ€</th>
                                        </tr>
                                    </thead>
                                    <tbody id="adoptionDetailTableBody"></tbody>
                                </table>
                            </div>
                            <div class="mt-3 text-xs text-gray-500">
                                <p>* ì£¼ìš” ì§€ìì²´ì˜ ë¶„ì•¼ë³„ ë„ì… í˜„í™©</p>
                                <p>* ê¸°íƒ€: ì‚°ì—…Â·ê²½ì œ, ë¬¸í™”Â·ê´€ê´‘, í™˜ê²½Â·ì—ë„ˆì§€ í•©ê³„</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ìš´ì˜ ê¸°ê´€ íƒ­ -->
                <div id="operating-content" class="tab-content space-y-6" style="display: none;">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">ìš´ì˜ ê¸°ê´€ë³„ í˜„í™© (ìƒìœ„ 10ê°œ)</h2>
                            <div class="chart-container">
                                <canvas id="operatingChart"></canvas>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">ìš´ì˜ ê¸°ê´€ ìœ í˜•ë³„ ë¶„í¬</h2>
                            <div class="space-y-4" id="operatingTypeInfo"></div>
                        </div>
                    </div>

                    <!-- ìš´ì˜ ê¸°ê´€ ìƒì„¸ í˜„í™© í…Œì´ë¸” -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">ì „ì²´ ìš´ì˜ ê¸°ê´€ í˜„í™©</h2>
                        <div class="max-h-96 overflow-y-auto">
                            <table class="w-full text-sm" id="operatingTable">
                                <thead class="sticky top-0 bg-gray-50">
                                    <tr class="border-b border-gray-200">
                                        <th class="text-left py-2 px-3">ìˆœìœ„</th>
                                        <th class="text-left py-2 px-3">ìš´ì˜ ê¸°ê´€ëª…</th>
                                        <th class="text-right py-2 px-3">ìš´ì˜ ì„œë¹„ìŠ¤ ìˆ˜</th>
                                        <th class="text-center py-2 px-3">ê¸°ê´€ ìœ í˜•</th>
                                    </tr>
                                </thead>
                                <tbody id="operatingTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- ì‹œê³„ì—´ ë¶„ì„ íƒ­ -->
                <div id="timeline-content" class="tab-content space-y-6" style="display: none;">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">ì—°ë„ë³„ AI ì„œë¹„ìŠ¤ ë„ì… ì¶”ì´</h2>
                        <div class="chart-container">
                            <canvas id="timelineChart"></canvas>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">ì—°ë„ë³„ ìƒì„¸ í˜„í™© (ë§‰ëŒ€ ê·¸ë˜í”„)</h2>
                            <div class="small-chart-container">
                                <canvas id="timelineBarChart"></canvas>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">ì—°ë„ë³„ ì¦ê° ë¶„ì„</h2>
                            <div class="space-y-4" id="yearAnalysis"></div>
                        </div>
                    </div>
                </div>

                <!-- ì„œë¹„ìŠ¤ ëŒ€ìƒ íƒ­ -->
                <div id="target-content" class="tab-content space-y-6" style="display: none;">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">ì„œë¹„ìŠ¤ ëŒ€ìƒë³„ ë¶„í¬ (ì›í˜• ì°¨íŠ¸)</h2>
                            <div class="chart-container">
                                <canvas id="targetPieChart"></canvas>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">ì„œë¹„ìŠ¤ ëŒ€ìƒë³„ í˜„í™© (ë§‰ëŒ€ ì°¨íŠ¸)</h2>
                            <div class="chart-container">
                                <canvas id="targetBarChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">ì„œë¹„ìŠ¤ ëŒ€ìƒë³„ ìƒì„¸ ë¶„ì„</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="targetDetails"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let data = {};
        let charts = {};
        const COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884D8', '#82CA9D', '#FFC658', '#FF7C7C'];

        // íŒŒì¼ ì—…ë¡œë“œ ì´ë²¤íŠ¸ ì„¤ì •
        document.addEventListener('DOMContentLoaded', function() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');

            // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, unhighlight, false);
            });

            function highlight(e) {
                uploadArea.classList.add('dragover');
            }

            function unhighlight(e) {
                uploadArea.classList.remove('dragover');
            }

            uploadArea.addEventListener('drop', handleDrop, false);
            uploadArea.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileSelect);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFiles(files);
            }

            function handleFileSelect(e) {
                const files = e.target.files;
                handleFiles(files);
            }

            function handleFiles(files) {
                if (files.length > 0) {
                    const file = files[0];
                    if (file.type === 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' || 
                        file.type === 'application/vnd.ms-excel' ||
                        file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                        processExcelFile(file);
                    } else {
                        alert('Excel íŒŒì¼(.xlsx, .xls)ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    }
                }
            }
        });

        // Excel íŒŒì¼ ì²˜ë¦¬
        async function processExcelFile(file) {
            document.getElementById('loadingIndicator').classList.remove('hidden');
            document.getElementById('fileName').textContent = `ì—…ë¡œë“œëœ íŒŒì¼: ${file.name}`;
            document.getElementById('fileName').classList.remove('hidden');

            try {
                const arrayBuffer = await file.arrayBuffer();
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                
                // AI ë“±ë¡ì œ ì‹œíŠ¸ì—ì„œ ë°ì´í„° ì¶”ì¶œ
                const worksheet = workbook.Sheets['AI ë“±ë¡ì œ'];
                if (!worksheet) {
                    throw new Error('AI ë“±ë¡ì œ ì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }

                const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                
                // í—¤ë” í–‰ì„ ì œì™¸í•˜ê³  ë°ì´í„° ì¶”ì¶œ
                const headers = jsonData[0];
                const rows = jsonData.slice(1).filter(row => row[0]); // ë¹ˆ í–‰ ì œê±°

                // ë°ì´í„° ë³€í™˜
                transformData(headers, rows);
                
                // ëŒ€ì‹œë³´ë“œ í‘œì‹œ
                document.getElementById('uploadSection').style.display = 'none';
                document.getElementById('dashboardContent').classList.remove('hidden');
                
                // ì°¨íŠ¸ ë Œë”ë§
                renderOverviewCharts();
                
            } catch (error) {
                console.error('íŒŒì¼ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                alert('íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            } finally {
                document.getElementById('loadingIndicator').classList.add('hidden');
            }
        }

        // ë°ì´í„° ë³€í™˜ í•¨ìˆ˜
        function transformData(headers, rows) {
            // ì»¬ëŸ¼ ì¸ë±ìŠ¤ ì°¾ê¸°
            const getColumnIndex = (columnName) => {
                return headers.findIndex(header => header && header.includes(columnName));
            };

            const categoryIndex = getColumnIndex('í™œìš©ë¶„ì•¼');
            const adoptionIndex = getColumnIndex('ë„ì… ì§€ìì²´');
            const targetIndex = getColumnIndex('ì„œë¹„ìŠ¤ ëŒ€ìƒ');
            const aiTypeIndex = getColumnIndex('AI ì„œë¹„ìŠ¤ ìœ í˜•');
            const startDateIndex = getColumnIndex('ì„œë¹„ìŠ¤ ê°œì‹œì¼');
            const operatingIndex = getColumnIndex('ìš´ì˜ ê¸°ê´€');

            // ì „ì²´ ì„œë¹„ìŠ¤ ìˆ˜
            data.total = rows.length;

            // í™œìš©ë¶„ì•¼ë³„ ì§‘ê³„
            const categoryCount = {};
            rows.forEach(row => {
                const category = row[categoryIndex];
                if (category) {
                    categoryCount[category] = (categoryCount[category] || 0) + 1;
                }
            });
            data.categories = Object.entries(categoryCount).sort((a, b) => b[1] - a[1]);

            // ë„ì… ì§€ìì²´ë³„ ì§‘ê³„
            const adoptionCount = {};
            rows.forEach(row => {
                const adoption = row[adoptionIndex];
                if (adoption) {
                    adoptionCount[adoption] = (adoptionCount[adoption] || 0) + 1;
                }
            });
            data.adoptionAgencies = Object.entries(adoptionCount).sort((a, b) => b[1] - a[1]);

            // ìš´ì˜ ê¸°ê´€ë³„ ì§‘ê³„
            const operatingCount = {};
            rows.forEach(row => {
                const operating = row[operatingIndex];
                if (operating) {
                    operatingCount[operating] = (operatingCount[operating] || 0) + 1;
                }
            });
            data.operatingAgencies = Object.entries(operatingCount).sort((a, b) => b[1] - a[1]);

            // ì„œë¹„ìŠ¤ ëŒ€ìƒë³„ ì§‘ê³„
            const targetCount = {};
            rows.forEach(row => {
                const target = row[targetIndex];
                if (target) {
                    // ì—¬ëŸ¬ ëŒ€ìƒì´ ì½¤ë§ˆë¡œ êµ¬ë¶„ëœ ê²½ìš° ì²˜ë¦¬
                    const targets = target.split(',').map(t => t.trim());
                    targets.forEach(t => {
                        if (t) {
                            targetCount[t] = (targetCount[t] || 0) + 1;
                        }
                    });
                }
            });
            data.targets = Object.entries(targetCount).sort((a, b) => b[1] - a[1]);

            // AI ì„œë¹„ìŠ¤ ìœ í˜•ë³„ ì§‘ê³„
            const aiTypeCount = {};
            rows.forEach(row => {
                const aiType = row[aiTypeIndex];
                if (aiType) {
                    aiTypeCount[aiType] = (aiTypeCount[aiType] || 0) + 1;
                }
            });
            data.aiTypes = Object.entries(aiTypeCount).sort((a, b) => b[1] - a[1]);

            // ì—°ë„ë³„ ì§‘ê³„
            const yearCount = {};
            rows.forEach(row => {
                const startDate = row[startDateIndex];
                if (startDate) {
                    let year;
                    if (typeof startDate === 'number') {
                        // Excel ì‹œë¦¬ì–¼ ë‚ ì§œì¸ ê²½ìš°
                        const date = new Date((startDate - 25569) * 86400 * 1000);
                        year = date.getFullYear();
                    } else if (typeof startDate === 'string') {
                        // ë¬¸ìì—´ ë‚ ì§œì¸ ê²½ìš°
                        const match = startDate.match(/(\d{4})/);
                        if (match) {
                            year = parseInt(match[1]);
                        }
                    }
                    
                    if (year && year >= 2020 && year <= 2030) {
                        yearCount[year] = (yearCount[year] || 0) + 1;
                    }
                }
            });
            data.yearData = Object.entries(yearCount).sort((a, b) => a[0] - b[0]);

            // ì§€ìì²´ë³„ ë¶„ì•¼ë³„ ì§‘ê³„
            const adoptionCategoryData = {};
            rows.forEach(row => {
                const adoption = row[adoptionIndex];
                const category = row[categoryIndex];
                if (adoption && category) {
                    if (!adoptionCategoryData[adoption]) {
                        adoptionCategoryData[adoption] = {};
                    }
                    adoptionCategoryData[adoption][category] = (adoptionCategoryData[adoption][category] || 0) + 1;
                }
            });

            data.adoptionCategoryData = Object.entries(adoptionCategoryData)
                .map(([name, categories]) => ({ name, ...categories }))
                .sort((a, b) => {
                    const aTotal = Object.keys(a).filter(k => k !== 'name').reduce((sum, k) => sum + (a[k] || 0), 0);
                    const bTotal = Object.keys(b).filter(k => k !== 'name').reduce((sum, k) => sum + (b[k] || 0), 0);
                    return bTotal - aTotal;
                })
                .slice(0, 12); // ìƒìœ„ 12ê°œë§Œ ì„ íƒ

            console.log('ë°ì´í„° ë³€í™˜ ì™„ë£Œ:', data);
        }

        // íƒ­ ì „í™˜ í•¨ìˆ˜
        function setActiveTab(tabId) {
            // ëª¨ë“  íƒ­ ì½˜í…ì¸  ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab-button').forEach(button => {
                button.className = button.className.replace('border-blue-500 text-blue-600 font-medium', 'border-transparent text-gray-500 hover:text-gray-700');
            });
            
            // ì„ íƒëœ íƒ­ í™œì„±í™”
            document.getElementById(tabId + '-content').style.display = 'block';
            document.querySelector(`[data-tab="${tabId}"]`).className = 
                document.querySelector(`[data-tab="${tabId}"]`).className.replace('border-transparent text-gray-500 hover:text-gray-700', 'border-blue-500 text-blue-600 font-medium');
            
            // ì°¨íŠ¸ ë Œë”ë§
            setTimeout(() => {
                renderChartsForTab(tabId);
            }, 100);
        }

        // ì°¨íŠ¸ ë Œë”ë§ í•¨ìˆ˜
        function renderChartsForTab(tabId) {
            switch(tabId) {
                case 'overview':
                    renderOverviewCharts();
                    break;
                case 'category':
                    renderCategoryCharts();
                    renderCategoryTable();
                    break;
                case 'adoption':
                    renderAdoptionCharts();
                    renderAdoptionTables();
                    break;
                case 'operating':
                    renderOperatingCharts();
                    renderOperatingTable();
                    break;
                case 'timeline':
                    renderTimelineCharts();
                    renderYearAnalysis();
                    break;
                case 'target':
                    renderTargetCharts();
                    renderTargetDetails();
                    break;
            }
        }

        function renderOverviewCharts() {
            // ì£¼ìš” ì§€í‘œ ì¹´ë“œ ë Œë”ë§
            const keyMetrics = document.getElementById('keyMetrics');
            const currentYear = new Date().getFullYear();
            const currentYearServices = data.yearData.find(([year]) => parseInt(year) === currentYear)?.[1] || 0;
            
            keyMetrics.innerHTML = `
                <div class="text-center p-3 bg-blue-50 rounded-lg">
                    <p class="text-2xl font-bold text-blue-600">${data.total}</p>
                    <p class="text-sm text-gray-600">ì´ AI ì„œë¹„ìŠ¤</p>
                </div>
                <div class="text-center p-3 bg-green-50 rounded-lg">
                    <p class="text-2xl font-bold text-green-600">${data.adoptionAgencies.length}</p>
                    <p class="text-sm text-gray-600">ë„ì… ì§€ìì²´</p>
                </div>
                <div class="text-center p-3 bg-purple-50 rounded-lg">
                    <p class="text-2xl font-bold text-purple-600">${data.operatingAgencies.length}</p>
                    <p class="text-sm text-gray-600">ìš´ì˜ ê¸°ê´€</p>
                </div>
                <div class="text-center p-3 bg-yellow-50 rounded-lg">
                    <p class="text-2xl font-bold text-yellow-600">${data.categories.length}</p>
                    <p class="text-sm text-gray-600">í™œìš© ë¶„ì•¼</p>
                </div>
                <div class="text-center p-3 bg-red-50 rounded-lg">
                    <p class="text-2xl font-bold text-red-600">${currentYearServices}</p>
                    <p class="text-sm text-gray-600">${currentYear}ë…„ ì„œë¹„ìŠ¤</p>
                </div>
            `;

            // ì£¼ìš” ì¸ì‚¬ì´íŠ¸ ë Œë”ë§
            const insights = document.getElementById('insights');
            const topCategory = data.categories[0];
            const topAdoption = data.adoptionAgencies[0];
            
            insights.innerHTML = `
                <div class="p-4 bg-blue-50 rounded-lg">
                    <h3 class="font-bold text-blue-800 mb-2">ê°€ì¥ í™œë°œí•œ ë¶„ì•¼</h3>
                    <p class="text-blue-600">${topCategory[0]} ë¶„ì•¼ì—ì„œ ${topCategory[1]}ê°œì˜ AI ì„œë¹„ìŠ¤ê°€ ìš´ì˜ ì¤‘ìœ¼ë¡œ ê°€ì¥ í™œë°œí•©ë‹ˆë‹¤.</p>
                </div>
                <div class="p-4 bg-green-50 rounded-lg">
                    <h3 class="font-bold text-green-800 mb-2">ì£¼ìš” ë„ì… ì§€ìì²´</h3>
                    <p class="text-green-600">${topAdoption[0]}ê°€ ${topAdoption[1]}ê°œ ì„œë¹„ìŠ¤ë¡œ ê°€ì¥ ë§ì´ ë„ì…í–ˆìŠµë‹ˆë‹¤.</p>
                </div>
                <div class="p-4 bg-purple-50 rounded-lg">
                    <h3 class="font-bold text-purple-800 mb-2">ìš´ì˜ ì²´ê³„ ë‹¤ì–‘ì„±</h3>
                    <p class="text-purple-600">ì´ ${data.operatingAgencies.length}ê°œ ìš´ì˜ ê¸°ê´€ì´ ì°¸ì—¬í•˜ì—¬ ë‹¤ì–‘í•œ ìš´ì˜ ëª¨ë¸ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>
                </div>
                <div class="p-4 bg-yellow-50 rounded-lg">
                    <h3 class="font-bold text-yellow-800 mb-2">ì„œë¹„ìŠ¤ ëŒ€ìƒ ë‹¤ì–‘ì„±</h3>
                    <p class="text-yellow-600">${data.targets.length}ê°œì˜ ë‹¤ì–‘í•œ ì„œë¹„ìŠ¤ ëŒ€ìƒìœ¼ë¡œ í¬ê´„ì ì¸ AI ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>
                </div>
            `;

            // í™œìš©ë¶„ì•¼ë³„ í˜„í™© ì°¨íŠ¸
            if (charts.categoryChart) charts.categoryChart.destroy();
            const ctx1 = document.getElementById('categoryChart').getContext('2d');
            charts.categoryChart = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: data.categories.map(item => item[0]),
                    datasets: [{
                        label: 'ì„œë¹„ìŠ¤ ìˆ˜',
                        data: data.categories.map(item => item[1]),
                        backgroundColor: '#0088FE'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                maxRotation: 45
                            }
                        },
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // ì—°ë„ë³„ ì¶”ì´ ì°¨íŠ¸
            if (charts.yearChart) charts.yearChart.destroy();
            const ctx2 = document.getElementById('yearChart').getContext('2d');
            charts.yearChart = new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: data.yearData.map(item => item[0]),
                    datasets: [{
                        label: 'ì„œë¹„ìŠ¤ ìˆ˜',
                        data: data.yearData.map(item => item[1]),
                        borderColor: '#00C49F',
                        backgroundColor: 'rgba(0, 196, 159, 0.1)',
                        borderWidth: 3,
                        pointRadius: 6,
                        pointBackgroundColor: '#00C49F'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function renderCategoryCharts() {
            // í™œìš©ë¶„ì•¼ë³„ ìƒì„¸ í˜„í™©
            if (charts.categoryDetailChart) charts.categoryDetailChart.destroy();
            const ctx1 = document.getElementById('categoryDetailChart').getContext('2d');
            charts.categoryDetailChart = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: data.categories.map(item => item[0]),
                    datasets: [{
                        label: 'ì„œë¹„ìŠ¤ ìˆ˜',
                        data: data.categories.map(item => item[1]),
                        backgroundColor: '#0088FE'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                maxRotation: 45
                            }
                        },
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // AI ì„œë¹„ìŠ¤ ìœ í˜•ë³„ ë¶„ì„
            if (charts.aiTypeChart) charts.aiTypeChart.destroy();
            const ctx2 = document.getElementById('aiTypeChart').getContext('2d');
            charts.aiTypeChart = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: data.aiTypes.map(item => item[0]),
                    datasets: [{
                        label: 'ì„œë¹„ìŠ¤ ìˆ˜',
                        data: data.aiTypes.map(item => item[1]),
                        backgroundColor: '#FF8042'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                maxRotation: 45
                            }
                        },
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function renderCategoryTable() {
            // í™œìš©ë¶„ì•¼ë³„ í…Œì´ë¸”
            const categoryTableEl = document.getElementById('categoryTable');
            categoryTableEl.innerHTML = data.categories.map(([name, count]) => 
                `<div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                    <span>${name}</span>
                    <span class="font-bold text-blue-600">${count}ê°œ</span>
                </div>`
            ).join('');

            // AI ìœ í˜•ë³„ í…Œì´ë¸”
            const aiTypeTableEl = document.getElementById('aiTypeTable');
            aiTypeTableEl.innerHTML = data.aiTypes.slice(0, 8).map(([name, count]) => 
                `<div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                    <span class="text-sm">${name}</span>
                    <span class="font-bold text-orange-600">${count}ê°œ</span>
                </div>`
            ).join('');
        }

        function renderAdoptionCharts() {
            // ë„ì… ì§€ìì²´ë³„ í˜„í™© (ìƒìœ„ 10ê°œ)
            if (charts.adoptionChart) charts.adoptionChart.destroy();
            const ctx1 = document.getElementById('adoptionChart').getContext('2d');
            const topAdoption = data.adoptionAgencies.slice(0, 10);
            charts.adoptionChart = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: topAdoption.map(item => item[0]),
                    datasets: [{
                        label: 'ë„ì… ì„œë¹„ìŠ¤ ìˆ˜',
                        data: topAdoption.map(item => item[1]),
                        backgroundColor: '#0088FE'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                maxRotation: 45
                            }
                        },
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // ì§€ìì²´ë³„ ë„ì… ë¶„ì•¼ í˜„í™© (ìŠ¤íƒ ì°¨íŠ¸)
            if (charts.adoptionCategoryChart) charts.adoptionCategoryChart.destroy();
            const ctx2 = document.getElementById('adoptionCategoryChart').getContext('2d');
            
            // ëª¨ë“  ë¶„ì•¼ ìˆ˜ì§‘
            const allFields = [...new Set(data.categories.map(([field]) => field))];
            const fieldColors = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884D8', '#82CA9D', '#FFC658', '#FF7C7C'];
            
            charts.adoptionCategoryChart = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: data.adoptionCategoryData.map(item => item.name),
                    datasets: allFields.map((field, index) => ({
                        label: field,
                        data: data.adoptionCategoryData.map(item => item[field] || 0),
                        backgroundColor: fieldColors[index % fieldColors.length]
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            ticks: {
                                maxRotation: 45
                            }
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function renderAdoptionTables() {
            // ì „ì²´ ë„ì… ì§€ìì²´ í˜„í™© í…Œì´ë¸”
            const tbody1 = document.getElementById('adoptionTableBody');
            tbody1.innerHTML = data.adoptionAgencies.map(([name, count], index) => 
                `<tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-2 px-3">${index + 1}</td>
                    <td class="py-2 px-3">${name}</td>
                    <td class="text-right py-2 px-3 font-medium">${count}ê°œ</td>
                    <td class="text-right py-2 px-3 text-gray-600">${((count / data.total) * 100).toFixed(1)}%</td>
                </tr>`
            ).join('');

            // ì§€ìì²´ë³„ ë„ì… ë¶„ì•¼ ë¶„ì„ í…Œì´ë¸”
            const tbody2 = document.getElementById('adoptionDetailTableBody');
            const mainFields = ['ë³µì§€', 'í–‰ì •', 'êµí†µÂ·ì•ˆì „', 'ì˜ë£Œ', 'êµìœ¡'];
            const otherFields = ['ì‚°ì—…Â·ê²½ì œ', 'ë¬¸í™”Â·ê´€ê´‘', 'í™˜ê²½Â·ì—ë„ˆì§€'];
            
            tbody2.innerHTML = data.adoptionCategoryData.map((agency) => {
                const getCellContent = (fieldName) => {
                    const count = agency[fieldName];
                    if (!count) return '-';
                    const colors = {
                        'ë³µì§€': 'bg-blue-100 text-blue-800',
                        'í–‰ì •': 'bg-green-100 text-green-800',
                        'êµí†µÂ·ì•ˆì „': 'bg-yellow-100 text-yellow-800',
                        'ì˜ë£Œ': 'bg-red-100 text-red-800',
                        'êµìœ¡': 'bg-purple-100 text-purple-800'
                    };
                    const colorClass = colors[fieldName] || 'bg-gray-100 text-gray-800';
                    return `<span class="${colorClass} px-1 rounded text-xs">${count}</span>`;
                };

                const ê¸°íƒ€í•©ê³„ = otherFields.reduce((sum, field) => sum + (agency[field] || 0), 0);
                const ê¸°íƒ€ = ê¸°íƒ€í•©ê³„ ? `<span class="bg-gray-100 text-gray-800 px-1 rounded text-xs">${ê¸°íƒ€í•©ê³„}</span>` : '-';
                
                return `<tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-2 px-2 font-medium text-xs">${agency.name}</td>
                    ${mainFields.map(field => `<td class="text-center py-2 px-1">${getCellContent(field)}</td>`).join('')}
                    <td class="text-center py-2 px-1">${ê¸°íƒ€}</td>
                </tr>`;
            }).join('');
        }

        function renderOperatingCharts() {
            // ìš´ì˜ ê¸°ê´€ë³„ í˜„í™© (ìƒìœ„ 10ê°œ)
            if (charts.operatingChart) charts.operatingChart.destroy();
            const ctx1 = document.getElementById('operatingChart').getContext('2d');
            const topOperating = data.operatingAgencies.slice(0, 10);
            charts.operatingChart = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: topOperating.map(item => item[0]),
                    datasets: [{
                        label: 'ìš´ì˜ ì„œë¹„ìŠ¤ ìˆ˜',
                        data: topOperating.map(item => item[1]),
                        backgroundColor: '#FF8042'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                maxRotation: 45
                            }
                        },
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // ìš´ì˜ ê¸°ê´€ ìœ í˜•ë³„ ë¶„í¬ ì •ë³´
            const ì§€ìì²´ìˆ˜ = data.operatingAgencies.filter(([name]) => 
                name.includes('ì‹œ') || name.includes('êµ°') || name.includes('êµ¬') || name === 'ê²½ê¸°ë„'
            ).length;
            const ê³µì‚¬ê³µë‹¨ìˆ˜ = data.operatingAgencies.filter(([name]) => 
                name.includes('ê³µì‚¬') || name.includes('ê³µë‹¨')
            ).length;
            const ì „ë¬¸ê¸°ê´€ìˆ˜ = data.operatingAgencies.filter(([name]) => 
                name.includes('ì§„í¥') || name.includes('í…Œí¬ë…¸íŒŒí¬') || name.includes('ì¬ë‹¨')
            ).length;
            const ê¸°íƒ€ìˆ˜ = data.operatingAgencies.length - ì§€ìì²´ìˆ˜ - ê³µì‚¬ê³µë‹¨ìˆ˜ - ì „ë¬¸ê¸°ê´€ìˆ˜;

            document.getElementById('operatingTypeInfo').innerHTML = `
                <div class="p-4 bg-blue-50 rounded-lg">
                    <h3 class="font-bold text-blue-800 mb-2">ì§€ë°©ìì¹˜ë‹¨ì²´</h3>
                    <p class="text-blue-600">ì§ì ‘ ìš´ì˜í•˜ëŠ” ì§€ìì²´ê°€ ë‹¤ìˆ˜ë¥¼ ì°¨ì§€í•©ë‹ˆë‹¤.</p>
                    <div class="text-2xl font-bold text-blue-800 mt-2">${ì§€ìì²´ìˆ˜}ê°œ ê¸°ê´€</div>
                </div>
                <div class="p-4 bg-green-50 rounded-lg">
                    <h3 class="font-bold text-green-800 mb-2">ê³µì‚¬/ê³µë‹¨</h3>
                    <p class="text-green-600">ë„ì‹œê°œë°œê³µì‚¬, ì£¼íƒë„ì‹œê³µì‚¬ ë“± ê³µê³µê¸°ê´€ì…ë‹ˆë‹¤.</p>
                    <div class="text-2xl font-bold text-green-800 mt-2">${ê³µì‚¬ê³µë‹¨ìˆ˜}ê°œ ê¸°ê´€</div>
                </div>
                <div class="p-4 bg-purple-50 rounded-lg">
                    <h3 class="font-bold text-purple-800 mb-2">ì „ë¬¸ê¸°ê´€</h3>
                    <p class="text-purple-600">í…Œí¬ë…¸íŒŒí¬, ì§„í¥ì› ë“± ì „ë¬¸ ìš´ì˜ê¸°ê´€ì…ë‹ˆë‹¤.</p>
                    <div class="text-2xl font-bold text-purple-800 mt-2">${ì „ë¬¸ê¸°ê´€ìˆ˜}ê°œ ê¸°ê´€</div>
                </div>
                ${ê¸°íƒ€ìˆ˜ > 0 ? `
                <div class="p-4 bg-gray-50 rounded-lg">
                    <h3 class="font-bold text-gray-800 mb-2">ê¸°íƒ€</h3>
                    <p class="text-gray-600">ê¸°íƒ€ ìš´ì˜ê¸°ê´€ì…ë‹ˆë‹¤.</p>
                    <div class="text-2xl font-bold text-gray-800 mt-2">${ê¸°íƒ€ìˆ˜}ê°œ ê¸°ê´€</div>
                </div>
                ` : ''}
            `;
        }

        function renderOperatingTable() {
            const tbody = document.getElementById('operatingTableBody');
            tbody.innerHTML = data.operatingAgencies.map(([name, count], index) => {
                let type = 'ê¸°íƒ€';
                if (name.includes('ì‹œ') || name.includes('êµ°') || name.includes('êµ¬') || name === 'ê²½ê¸°ë„') {
                    type = 'ì§€ìì²´';
                } else if (name.includes('ê³µì‚¬') || name.includes('ê³µë‹¨')) {
                    type = 'ê³µì‚¬/ê³µë‹¨';
                } else if (name.includes('ì§„í¥') || name.includes('í…Œí¬ë…¸íŒŒí¬') || name.includes('ì¬ë‹¨')) {
                    type = 'ì „ë¬¸ê¸°ê´€';
                }
                
                const typeClass = type === 'ì§€ìì²´' ? 'bg-blue-100 text-blue-800' :
                               type === 'ê³µì‚¬/ê³µë‹¨' ? 'bg-green-100 text-green-800' :
                               type === 'ì „ë¬¸ê¸°ê´€' ? 'bg-purple-100 text-purple-800' :
                               'bg-gray-100 text-gray-800';
                
                return `<tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-2 px-3">${index + 1}</td>
                    <td class="py-2 px-3">${name}</td>
                    <td class="text-right py-2 px-3 font-medium">${count}ê°œ</td>
                    <td class="text-center py-2 px-3">
                        <span class="px-2 py-1 rounded-full text-xs ${typeClass}">${type}</span>
                    </td>
                </tr>`;
            }).join('');
        }

        function renderTimelineCharts() {
            // ì—°ë„ë³„ AI ì„œë¹„ìŠ¤ ë„ì… ì¶”ì´ (ë¼ì¸ ì°¨íŠ¸)
            if (charts.timelineChart) charts.timelineChart.destroy();
            const ctx1 = document.getElementById('timelineChart').getContext('2d');
            charts.timelineChart = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: data.yearData.map(item => item[0]),
                    datasets: [{
                        label: 'ì„œë¹„ìŠ¤ ìˆ˜',
                        data: data.yearData.map(item => item[1]),
                        borderColor: '#00C49F',
                        backgroundColor: 'rgba(0, 196, 159, 0.1)',
                        borderWidth: 4,
                        pointRadius: 8,
                        pointBackgroundColor: '#00C49F'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // ì—°ë„ë³„ ìƒì„¸ í˜„í™© (ë§‰ëŒ€ ì°¨íŠ¸)
            if (charts.timelineBarChart) charts.timelineBarChart.destroy();
            const ctx2 = document.getElementById('timelineBarChart').getContext('2d');
            charts.timelineBarChart = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: data.yearData.map(item => item[0]),
                    datasets: [{
                        label: 'ì„œë¹„ìŠ¤ ìˆ˜',
                        data: data.yearData.map(item => item[1]),
                        backgroundColor: '#8884D8'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function renderYearAnalysis() {
            const maxCount = Math.max(...data.yearData.map(([,count]) => count));
            document.getElementById('yearAnalysis').innerHTML = data.yearData.map(([year, count], index) => {
                const prevCount = index > 0 ? data.yearData[index - 1][1] : 0;
                const growth = prevCount > 0 ? ((count - prevCount) / prevCount * 100).toFixed(1) : 0;
                const growthText = index > 0 ? 
                    `<span class="${growth > 0 ? 'text-green-600' : growth < 0 ? 'text-red-600' : 'text-gray-600'}">
                        ${growth > 0 ? '+' : ''}${growth}% ì¦ê°
                    </span>` : '';
                
                return `<div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                    <div>
                        <span class="font-bold text-lg">${year}ë…„</span>
                        <div class="text-sm text-gray-600">${growthText}</div>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold text-blue-600">${count}ê°œ</div>
                        <div class="w-24 bg-gray-200 rounded-full h-2 mt-1">
                            <div class="bg-blue-500 h-2 rounded-full" style="width: ${(count / maxCount) * 100}%"></div>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        function renderTargetCharts() {
            // ì„œë¹„ìŠ¤ ëŒ€ìƒë³„ ë¶„í¬ (ì›í˜• ì°¨íŠ¸)
            if (charts.targetPieChart) charts.targetPieChart.destroy();
            const ctx1 = document.getElementById('targetPieChart').getContext('2d');
            charts.targetPieChart = new Chart(ctx1, {
                type: 'pie',
                data: {
                    labels: data.targets.map(item => item[0]),
                    datasets: [{
                        data: data.targets.map(item => item[1]),
                        backgroundColor: COLORS
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });

            // ì„œë¹„ìŠ¤ ëŒ€ìƒë³„ í˜„í™© (ë§‰ëŒ€ ì°¨íŠ¸)
            if (charts.targetBarChart) charts.targetBarChart.destroy();
            const ctx2 = document.getElementById('targetBarChart').getContext('2d');
            charts.targetBarChart = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: data.targets.map(item => item[0]),
                    datasets: [{
                        label: 'ì„œë¹„ìŠ¤ ìˆ˜',
                        data: data.targets.map(item => item[1]),
                        backgroundColor: '#FFC658'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                maxRotation: 45
                            }
                        },
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function renderTargetDetails() {
            const maxCount = Math.max(...data.targets.map(([,count]) => count));
            document.getElementById('targetDetails').innerHTML = data.targets.map(([name, count]) => 
                `<div class="p-4 border border-gray-200 rounded-lg hover:shadow-md transition-shadow">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-blue-600 mb-2">${count}ê°œ</div>
                        <div class="text-sm font-medium text-gray-700">${name}</div>
                        <div class="mt-2 w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-blue-500 h-2 rounded-full" style="width: ${(count / maxCount) * 100}%"></div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">${((count / data.total) * 100).toFixed(1)}%</div>
                    </div>
                </div>`
            ).join('');
        }
    </script>
</body>
</html>
