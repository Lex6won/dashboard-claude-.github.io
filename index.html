<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>경기도 AI 등록제 서비스 현황</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }
        .small-chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        .file-upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 0.5rem;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
        }
        .file-upload-area:hover {
            border-color: #6366f1;
            background-color: #f8fafc;
        }
        .file-upload-area.dragover {
            border-color: #6366f1;
            background-color: #eef2ff;
        }
    </style>
</head>
<body>
    <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
        <!-- 헤더 -->
        <div class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="text-center">
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">경기도 AI 등록제 서비스 현황</h1>
                    <p class="text-gray-600">동적 데이터 분석 대시보드</p>
                </div>
            </div>
        </div>

        <!-- 파일 업로드 영역 -->
        <div class="max-w-7xl mx-auto px-6 py-6" id="uploadSection">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Excel 파일 업로드</h2>
                <div class="file-upload-area" id="uploadArea">
                    <div class="mb-4">
                        <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                            <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </div>
                    <div class="text-lg font-medium text-gray-900 mb-2">Excel 파일을 업로드하세요</div>
                    <div class="text-sm text-gray-500 mb-4">
                        Excel 파일(.xlsx, .xls)을 드래그 앤 드롭하거나 클릭하여 선택하세요
                    </div>
                    <input type="file" id="fileInput" accept=".xlsx,.xls" class="hidden">
                    <button onclick="document.getElementById('fileInput').click()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition-colors">
                        파일 선택
                    </button>
                </div>
                <div id="fileName" class="mt-4 text-sm text-green-600 hidden"></div>
                <div id="loadingIndicator" class="mt-4 text-center hidden">
                    <div class="inline-flex items-center px-4 py-2 font-semibold leading-6 text-sm shadow rounded-md text-white bg-blue-500 transition ease-in-out duration-150">
                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        데이터 처리 중...
                    </div>
                </div>
            </div>
        </div>

        <!-- 대시보드 콘텐츠 (초기에는 숨김) -->
        <div id="dashboardContent" class="hidden">
            <!-- 탭 네비게이션 -->
            <div class="bg-white border-b">
                <div class="max-w-7xl mx-auto px-6">
                    <div class="flex space-x-8 overflow-x-auto">
                        <button onclick="setActiveTab('overview')" class="tab-button flex items-center space-x-2 py-4 px-2 border-b-2 whitespace-nowrap transition-colors border-blue-500 text-blue-600 font-medium" data-tab="overview">
                            <span>📊</span>
                            <span>전체 현황</span>
                        </button>
                        <button onclick="setActiveTab('category')" class="tab-button flex items-center space-x-2 py-4 px-2 border-b-2 whitespace-nowrap transition-colors border-transparent text-gray-500 hover:text-gray-700" data-tab="category">
                            <span>📈</span>
                            <span>분야별 분석</span>
                        </button>
                        <button onclick="setActiveTab('adoption')" class="tab-button flex items-center space-x-2 py-4 px-2 border-b-2 whitespace-nowrap transition-colors border-transparent text-gray-500 hover:text-gray-700" data-tab="adoption">
                            <span>🏛️</span>
                            <span>도입 지자체</span>
                        </button>
                        <button onclick="setActiveTab('operating')" class="tab-button flex items-center space-x-2 py-4 px-2 border-b-2 whitespace-nowrap transition-colors border-transparent text-gray-500 hover:text-gray-700" data-tab="operating">
                            <span>⚙️</span>
                            <span>운영 기관</span>
                        </button>
                        <button onclick="setActiveTab('timeline')" class="tab-button flex items-center space-x-2 py-4 px-2 border-b-2 whitespace-nowrap transition-colors border-transparent text-gray-500 hover:text-gray-700" data-tab="timeline">
                            <span>📅</span>
                            <span>시계열 분석</span>
                        </button>
                        <button onclick="setActiveTab('target')" class="tab-button flex items-center space-x-2 py-4 px-2 border-b-2 whitespace-nowrap transition-colors border-transparent text-gray-500 hover:text-gray-700" data-tab="target">
                            <span>👥</span>
                            <span>서비스 대상</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- 콘텐츠 영역 -->
            <div class="max-w-7xl mx-auto px-6 py-6">
                <!-- 전체 현황 탭 -->
                <div id="overview-content" class="tab-content space-y-6">
                    <!-- 주요 지표 카드 -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-lg font-bold text-gray-800 mb-4">핵심 지표</h2>
                        <div class="grid grid-cols-2 md:grid-cols-5 gap-4" id="keyMetrics">
                            <!-- 동적으로 생성됨 -->
                        </div>
                    </div>

                    <!-- 주요 인사이트 -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">주요 인사이트</h2>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4" id="insights">
                            <!-- 동적으로 생성됨 -->
                        </div>
                    </div>

                    <!-- 요약 차트 -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">활용분야별 현황</h2>
                            <div class="small-chart-container">
                                <canvas id="categoryChart"></canvas>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">도입 연도별 추이</h2>
                            <div class="small-chart-container">
                                <canvas id="yearChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 분야별 분석 탭 -->
                <div id="category-content" class="tab-content space-y-6" style="display: none;">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">활용분야별 상세 현황</h2>
                            <div class="chart-container">
                                <canvas id="categoryDetailChart"></canvas>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">AI 서비스 유형별 분석</h2>
                            <div class="chart-container">
                                <canvas id="aiTypeChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- 분야별 상세 테이블 -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">분야별 상세 분포</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h3 class="font-semibold text-gray-700 mb-3">활용분야별</h3>
                                <div class="space-y-2" id="categoryTable"></div>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-700 mb-3">AI 유형별</h3>
                                <div class="space-y-2" id="aiTypeTable"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 도입 지자체 탭 -->
                <div id="adoption-content" class="tab-content space-y-6" style="display: none;">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">도입 지자체별 현황 (상위 10개)</h2>
                            <div class="chart-container">
                                <canvas id="adoptionChart"></canvas>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">지자체별 도입 분야 현황</h2>
                            <div class="chart-container">
                                <canvas id="adoptionCategoryChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- 도입 지자체 상세 현황 테이블 -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">전체 도입 지자체 현황</h2>
                            <div class="max-h-96 overflow-y-auto">
                                <table class="w-full text-sm" id="adoptionTable">
                                    <thead class="sticky top-0 bg-gray-50">
                                        <tr class="border-b border-gray-200">
                                            <th class="text-left py-2 px-3">순위</th>
                                            <th class="text-left py-2 px-3">지자체명</th>
                                            <th class="text-right py-2 px-3">도입 서비스 수</th>
                                            <th class="text-right py-2 px-3">비율</th>
                                        </tr>
                                    </thead>
                                    <tbody id="adoptionTableBody"></tbody>
                                </table>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">지자체별 도입 분야 분석</h2>
                            <div class="max-h-96 overflow-y-auto">
                                <table class="w-full text-xs" id="adoptionDetailTable">
                                    <thead class="sticky top-0 bg-gray-50">
                                        <tr class="border-b border-gray-200">
                                            <th class="text-left py-2 px-2">지자체명</th>
                                            <th class="text-center py-2 px-1">복지</th>
                                            <th class="text-center py-2 px-1">행정</th>
                                            <th class="text-center py-2 px-1">교통</th>
                                            <th class="text-center py-2 px-1">의료</th>
                                            <th class="text-center py-2 px-1">교육</th>
                                            <th class="text-center py-2 px-1">기타</th>
                                        </tr>
                                    </thead>
                                    <tbody id="adoptionDetailTableBody"></tbody>
                                </table>
                            </div>
                            <div class="mt-3 text-xs text-gray-500">
                                <p>* 주요 지자체의 분야별 도입 현황</p>
                                <p>* 기타: 산업·경제, 문화·관광, 환경·에너지 합계</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 운영 기관 탭 -->
                <div id="operating-content" class="tab-content space-y-6" style="display: none;">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">운영 기관별 현황 (상위 10개)</h2>
                            <div class="chart-container">
                                <canvas id="operatingChart"></canvas>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">운영 기관 유형별 분포</h2>
                            <div class="space-y-4" id="operatingTypeInfo"></div>
                        </div>
                    </div>

                    <!-- 운영 기관 상세 현황 테이블 -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">전체 운영 기관 현황</h2>
                        <div class="max-h-96 overflow-y-auto">
                            <table class="w-full text-sm" id="operatingTable">
                                <thead class="sticky top-0 bg-gray-50">
                                    <tr class="border-b border-gray-200">
                                        <th class="text-left py-2 px-3">순위</th>
                                        <th class="text-left py-2 px-3">운영 기관명</th>
                                        <th class="text-right py-2 px-3">운영 서비스 수</th>
                                        <th class="text-center py-2 px-3">기관 유형</th>
                                    </tr>
                                </thead>
                                <tbody id="operatingTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 시계열 분석 탭 -->
                <div id="timeline-content" class="tab-content space-y-6" style="display: none;">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">연도별 AI 서비스 도입 추이</h2>
                        <div class="chart-container">
                            <canvas id="timelineChart"></canvas>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">연도별 상세 현황 (막대 그래프)</h2>
                            <div class="small-chart-container">
                                <canvas id="timelineBarChart"></canvas>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">연도별 증감 분석</h2>
                            <div class="space-y-4" id="yearAnalysis"></div>
                        </div>
                    </div>
                </div>

                <!-- 서비스 대상 탭 -->
                <div id="target-content" class="tab-content space-y-6" style="display: none;">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">서비스 대상별 분포 (원형 차트)</h2>
                            <div class="chart-container">
                                <canvas id="targetPieChart"></canvas>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">서비스 대상별 현황 (막대 차트)</h2>
                            <div class="chart-container">
                                <canvas id="targetBarChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">서비스 대상별 상세 분석</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="targetDetails"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 전역 변수
        let data = {};
        let charts = {};
        const COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884D8', '#82CA9D', '#FFC658', '#FF7C7C'];

        // 파일 업로드 이벤트 설정
        document.addEventListener('DOMContentLoaded', function() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');

            // 드래그 앤 드롭 이벤트
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, unhighlight, false);
            });

            function highlight(e) {
                uploadArea.classList.add('dragover');
            }

            function unhighlight(e) {
                uploadArea.classList.remove('dragover');
            }

            uploadArea.addEventListener('drop', handleDrop, false);
            uploadArea.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileSelect);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFiles(files);
            }

            function handleFileSelect(e) {
                const files = e.target.files;
                handleFiles(files);
            }

            function handleFiles(files) {
                if (files.length > 0) {
                    const file = files[0];
                    if (file.type === 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' || 
                        file.type === 'application/vnd.ms-excel' ||
                        file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                        processExcelFile(file);
                    } else {
                        alert('Excel 파일(.xlsx, .xls)만 업로드 가능합니다.');
                    }
                }
            }
        });

        // Excel 파일 처리
        async function processExcelFile(file) {
            document.getElementById('loadingIndicator').classList.remove('hidden');
            document.getElementById('fileName').textContent = `업로드된 파일: ${file.name}`;
            document.getElementById('fileName').classList.remove('hidden');

            try {
                const arrayBuffer = await file.arrayBuffer();
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                
                // AI 등록제 시트에서 데이터 추출
                const worksheet = workbook.Sheets['AI 등록제'];
                if (!worksheet) {
                    throw new Error('AI 등록제 시트를 찾을 수 없습니다.');
                }

                const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                
                // 헤더 행을 제외하고 데이터 추출
                const headers = jsonData[0];
                const rows = jsonData.slice(1).filter(row => row[0]); // 빈 행 제거

                // 데이터 변환
                transformData(headers, rows);
                
                // 대시보드 표시
                document.getElementById('uploadSection').style.display = 'none';
                document.getElementById('dashboardContent').classList.remove('hidden');
                
                // 차트 렌더링
                renderOverviewCharts();
                
            } catch (error) {
                console.error('파일 처리 오류:', error);
                alert('파일 처리 중 오류가 발생했습니다: ' + error.message);
            } finally {
                document.getElementById('loadingIndicator').classList.add('hidden');
            }
        }

        // 데이터 변환 함수
        function transformData(headers, rows) {
            // 컬럼 인덱스 찾기
            const getColumnIndex = (columnName) => {
                return headers.findIndex(header => header && header.includes(columnName));
            };

            const categoryIndex = getColumnIndex('활용분야');
            const adoptionIndex = getColumnIndex('도입 지자체');
            const targetIndex = getColumnIndex('서비스 대상');
            const aiTypeIndex = getColumnIndex('AI 서비스 유형');
            const startDateIndex = getColumnIndex('서비스 개시일');
            const operatingIndex = getColumnIndex('운영 기관');

            // 전체 서비스 수
            data.total = rows.length;

            // 활용분야별 집계
            const categoryCount = {};
            rows.forEach(row => {
                const category = row[categoryIndex];
                if (category) {
                    categoryCount[category] = (categoryCount[category] || 0) + 1;
                }
            });
            data.categories = Object.entries(categoryCount).sort((a, b) => b[1] - a[1]);

            // 도입 지자체별 집계
            const adoptionCount = {};
            rows.forEach(row => {
                const adoption = row[adoptionIndex];
                if (adoption) {
                    adoptionCount[adoption] = (adoptionCount[adoption] || 0) + 1;
                }
            });
            data.adoptionAgencies = Object.entries(adoptionCount).sort((a, b) => b[1] - a[1]);

            // 운영 기관별 집계
            const operatingCount = {};
            rows.forEach(row => {
                const operating = row[operatingIndex];
                if (operating) {
                    operatingCount[operating] = (operatingCount[operating] || 0) + 1;
                }
            });
            data.operatingAgencies = Object.entries(operatingCount).sort((a, b) => b[1] - a[1]);

            // 서비스 대상별 집계
            const targetCount = {};
            rows.forEach(row => {
                const target = row[targetIndex];
                if (target) {
                    // 여러 대상이 콤마로 구분된 경우 처리
                    const targets = target.split(',').map(t => t.trim());
                    targets.forEach(t => {
                        if (t) {
                            targetCount[t] = (targetCount[t] || 0) + 1;
                        }
                    });
                }
            });
            data.targets = Object.entries(targetCount).sort((a, b) => b[1] - a[1]);

            // AI 서비스 유형별 집계
            const aiTypeCount = {};
            rows.forEach(row => {
                const aiType = row[aiTypeIndex];
                if (aiType) {
                    aiTypeCount[aiType] = (aiTypeCount[aiType] || 0) + 1;
                }
            });
            data.aiTypes = Object.entries(aiTypeCount).sort((a, b) => b[1] - a[1]);

            // 연도별 집계
            const yearCount = {};
            rows.forEach(row => {
                const startDate = row[startDateIndex];
                if (startDate) {
                    let year;
                    if (typeof startDate === 'number') {
                        // Excel 시리얼 날짜인 경우
                        const date = new Date((startDate - 25569) * 86400 * 1000);
                        year = date.getFullYear();
                    } else if (typeof startDate === 'string') {
                        // 문자열 날짜인 경우
                        const match = startDate.match(/(\d{4})/);
                        if (match) {
                            year = parseInt(match[1]);
                        }
                    }
                    
                    if (year && year >= 2020 && year <= 2030) {
                        yearCount[year] = (yearCount[year] || 0) + 1;
                    }
                }
            });
            data.yearData = Object.entries(yearCount).sort((a, b) => a[0] - b[0]);

            // 지자체별 분야별 집계
            const adoptionCategoryData = {};
            rows.forEach(row => {
                const adoption = row[adoptionIndex];
                const category = row[categoryIndex];
                if (adoption && category) {
                    if (!adoptionCategoryData[adoption]) {
                        adoptionCategoryData[adoption] = {};
                    }
                    adoptionCategoryData[adoption][category] = (adoptionCategoryData[adoption][category] || 0) + 1;
                }
            });

            data.adoptionCategoryData = Object.entries(adoptionCategoryData)
                .map(([name, categories]) => ({ name, ...categories }))
                .sort((a, b) => {
                    const aTotal = Object.keys(a).filter(k => k !== 'name').reduce((sum, k) => sum + (a[k] || 0), 0);
                    const bTotal = Object.keys(b).filter(k => k !== 'name').reduce((sum, k) => sum + (b[k] || 0), 0);
                    return bTotal - aTotal;
                })
                .slice(0, 12); // 상위 12개만 선택

            console.log('데이터 변환 완료:', data);
        }

        // 탭 전환 함수
        function setActiveTab(tabId) {
            // 모든 탭 콘텐츠 숨기기
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // 모든 탭 버튼 비활성화
            document.querySelectorAll('.tab-button').forEach(button => {
                button.className = button.className.replace('border-blue-500 text-blue-600 font-medium', 'border-transparent text-gray-500 hover:text-gray-700');
            });
            
            // 선택된 탭 활성화
            document.getElementById(tabId + '-content').style.display = 'block';
            document.querySelector(`[data-tab="${tabId}"]`).className = 
                document.querySelector(`[data-tab="${tabId}"]`).className.replace('border-transparent text-gray-500 hover:text-gray-700', 'border-blue-500 text-blue-600 font-medium');
            
            // 차트 렌더링
            setTimeout(() => {
                renderChartsForTab(tabId);
            }, 100);
        }

        // 차트 렌더링 함수
        function renderChartsForTab(tabId) {
            switch(tabId) {
                case 'overview':
                    renderOverviewCharts();
                    break;
                case 'category':
                    renderCategoryCharts();
                    renderCategoryTable();
                    break;
                case 'adoption':
                    renderAdoptionCharts();
                    renderAdoptionTables();
                    break;
                case 'operating':
                    renderOperatingCharts();
                    renderOperatingTable();
                    break;
                case 'timeline':
                    renderTimelineCharts();
                    renderYearAnalysis();
                    break;
                case 'target':
                    renderTargetCharts();
                    renderTargetDetails();
                    break;
            }
        }

        function renderOverviewCharts() {
            // 주요 지표 카드 렌더링
            const keyMetrics = document.getElementById('keyMetrics');
            const currentYear = new Date().getFullYear();
            const currentYearServices = data.yearData.find(([year]) => parseInt(year) === currentYear)?.[1] || 0;
            
            keyMetrics.innerHTML = `
                <div class="text-center p-3 bg-blue-50 rounded-lg">
                    <p class="text-2xl font-bold text-blue-600">${data.total}</p>
                    <p class="text-sm text-gray-600">총 AI 서비스</p>
                </div>
                <div class="text-center p-3 bg-green-50 rounded-lg">
                    <p class="text-2xl font-bold text-green-600">${data.adoptionAgencies.length}</p>
                    <p class="text-sm text-gray-600">도입 지자체</p>
                </div>
                <div class="text-center p-3 bg-purple-50 rounded-lg">
                    <p class="text-2xl font-bold text-purple-600">${data.operatingAgencies.length}</p>
                    <p class="text-sm text-gray-600">운영 기관</p>
                </div>
                <div class="text-center p-3 bg-yellow-50 rounded-lg">
                    <p class="text-2xl font-bold text-yellow-600">${data.categories.length}</p>
                    <p class="text-sm text-gray-600">활용 분야</p>
                </div>
                <div class="text-center p-3 bg-red-50 rounded-lg">
                    <p class="text-2xl font-bold text-red-600">${currentYearServices}</p>
                    <p class="text-sm text-gray-600">${currentYear}년 서비스</p>
                </div>
            `;

            // 주요 인사이트 렌더링
            const insights = document.getElementById('insights');
            const topCategory = data.categories[0];
            const topAdoption = data.adoptionAgencies[0];
            
            insights.innerHTML = `
                <div class="p-4 bg-blue-50 rounded-lg">
                    <h3 class="font-bold text-blue-800 mb-2">가장 활발한 분야</h3>
                    <p class="text-blue-600">${topCategory[0]} 분야에서 ${topCategory[1]}개의 AI 서비스가 운영 중으로 가장 활발합니다.</p>
                </div>
                <div class="p-4 bg-green-50 rounded-lg">
                    <h3 class="font-bold text-green-800 mb-2">주요 도입 지자체</h3>
                    <p class="text-green-600">${topAdoption[0]}가 ${topAdoption[1]}개 서비스로 가장 많이 도입했습니다.</p>
                </div>
                <div class="p-4 bg-purple-50 rounded-lg">
                    <h3 class="font-bold text-purple-800 mb-2">운영 체계 다양성</h3>
                    <p class="text-purple-600">총 ${data.operatingAgencies.length}개 운영 기관이 참여하여 다양한 운영 모델을 보여줍니다.</p>
                </div>
                <div class="p-4 bg-yellow-50 rounded-lg">
                    <h3 class="font-bold text-yellow-800 mb-2">서비스 대상 다양성</h3>
                    <p class="text-yellow-600">${data.targets.length}개의 다양한 서비스 대상으로 포괄적인 AI 서비스를 제공합니다.</p>
                </div>
            `;

            // 활용분야별 현황 차트
            if (charts.categoryChart) charts.categoryChart.destroy();
            const ctx1 = document.getElementById('categoryChart').getContext('2d');
            charts.categoryChart = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: data.categories.map(item => item[0]),
                    datasets: [{
                        label: '서비스 수',
                        data: data.categories.map(item => item[1]),
                        backgroundColor: '#0088FE'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                maxRotation: 45
                            }
                        },
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // 연도별 추이 차트
            if (charts.yearChart) charts.yearChart.destroy();
            const ctx2 = document.getElementById('yearChart').getContext('2d');
            charts.yearChart = new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: data.yearData.map(item => item[0]),
                    datasets: [{
                        label: '서비스 수',
                        data: data.yearData.map(item => item[1]),
                        borderColor: '#00C49F',
                        backgroundColor: 'rgba(0, 196, 159, 0.1)',
                        borderWidth: 3,
                        pointRadius: 6,
                        pointBackgroundColor: '#00C49F'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function renderCategoryCharts() {
            // 활용분야별 상세 현황
            if (charts.categoryDetailChart) charts.categoryDetailChart.destroy();
            const ctx1 = document.getElementById('categoryDetailChart').getContext('2d');
            charts.categoryDetailChart = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: data.categories.map(item => item[0]),
                    datasets: [{
                        label: '서비스 수',
                        data: data.categories.map(item => item[1]),
                        backgroundColor: '#0088FE'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                maxRotation: 45
                            }
                        },
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // AI 서비스 유형별 분석
            if (charts.aiTypeChart) charts.aiTypeChart.destroy();
            const ctx2 = document.getElementById('aiTypeChart').getContext('2d');
            charts.aiTypeChart = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: data.aiTypes.map(item => item[0]),
                    datasets: [{
                        label: '서비스 수',
                        data: data.aiTypes.map(item => item[1]),
                        backgroundColor: '#FF8042'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                maxRotation: 45
                            }
                        },
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function renderCategoryTable() {
            // 활용분야별 테이블
            const categoryTableEl = document.getElementById('categoryTable');
            categoryTableEl.innerHTML = data.categories.map(([name, count]) => 
                `<div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                    <span>${name}</span>
                    <span class="font-bold text-blue-600">${count}개</span>
                </div>`
            ).join('');

            // AI 유형별 테이블
            const aiTypeTableEl = document.getElementById('aiTypeTable');
            aiTypeTableEl.innerHTML = data.aiTypes.slice(0, 8).map(([name, count]) => 
                `<div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                    <span class="text-sm">${name}</span>
                    <span class="font-bold text-orange-600">${count}개</span>
                </div>`
            ).join('');
        }

        function renderAdoptionCharts() {
            // 도입 지자체별 현황 (상위 10개)
            if (charts.adoptionChart) charts.adoptionChart.destroy();
            const ctx1 = document.getElementById('adoptionChart').getContext('2d');
            const topAdoption = data.adoptionAgencies.slice(0, 10);
            charts.adoptionChart = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: topAdoption.map(item => item[0]),
                    datasets: [{
                        label: '도입 서비스 수',
                        data: topAdoption.map(item => item[1]),
                        backgroundColor: '#0088FE'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                maxRotation: 45
                            }
                        },
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // 지자체별 도입 분야 현황 (스택 차트)
            if (charts.adoptionCategoryChart) charts.adoptionCategoryChart.destroy();
            const ctx2 = document.getElementById('adoptionCategoryChart').getContext('2d');
            
            // 모든 분야 수집
            const allFields = [...new Set(data.categories.map(([field]) => field))];
            const fieldColors = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884D8', '#82CA9D', '#FFC658', '#FF7C7C'];
            
            charts.adoptionCategoryChart = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: data.adoptionCategoryData.map(item => item.name),
                    datasets: allFields.map((field, index) => ({
                        label: field,
                        data: data.adoptionCategoryData.map(item => item[field] || 0),
                        backgroundColor: fieldColors[index % fieldColors.length]
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            ticks: {
                                maxRotation: 45
                            }
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function renderAdoptionTables() {
            // 전체 도입 지자체 현황 테이블
            const tbody1 = document.getElementById('adoptionTableBody');
            tbody1.innerHTML = data.adoptionAgencies.map(([name, count], index) => 
                `<tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-2 px-3">${index + 1}</td>
                    <td class="py-2 px-3">${name}</td>
                    <td class="text-right py-2 px-3 font-medium">${count}개</td>
                    <td class="text-right py-2 px-3 text-gray-600">${((count / data.total) * 100).toFixed(1)}%</td>
                </tr>`
            ).join('');

            // 지자체별 도입 분야 분석 테이블
            const tbody2 = document.getElementById('adoptionDetailTableBody');
            const mainFields = ['복지', '행정', '교통·안전', '의료', '교육'];
            const otherFields = ['산업·경제', '문화·관광', '환경·에너지'];
            
            tbody2.innerHTML = data.adoptionCategoryData.map((agency) => {
                const getCellContent = (fieldName) => {
                    const count = agency[fieldName];
                    if (!count) return '-';
                    const colors = {
                        '복지': 'bg-blue-100 text-blue-800',
                        '행정': 'bg-green-100 text-green-800',
                        '교통·안전': 'bg-yellow-100 text-yellow-800',
                        '의료': 'bg-red-100 text-red-800',
                        '교육': 'bg-purple-100 text-purple-800'
                    };
                    const colorClass = colors[fieldName] || 'bg-gray-100 text-gray-800';
                    return `<span class="${colorClass} px-1 rounded text-xs">${count}</span>`;
                };

                const 기타합계 = otherFields.reduce((sum, field) => sum + (agency[field] || 0), 0);
                const 기타 = 기타합계 ? `<span class="bg-gray-100 text-gray-800 px-1 rounded text-xs">${기타합계}</span>` : '-';
                
                return `<tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-2 px-2 font-medium text-xs">${agency.name}</td>
                    ${mainFields.map(field => `<td class="text-center py-2 px-1">${getCellContent(field)}</td>`).join('')}
                    <td class="text-center py-2 px-1">${기타}</td>
                </tr>`;
            }).join('');
        }

        function renderOperatingCharts() {
            // 운영 기관별 현황 (상위 10개)
            if (charts.operatingChart) charts.operatingChart.destroy();
            const ctx1 = document.getElementById('operatingChart').getContext('2d');
            const topOperating = data.operatingAgencies.slice(0, 10);
            charts.operatingChart = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: topOperating.map(item => item[0]),
                    datasets: [{
                        label: '운영 서비스 수',
                        data: topOperating.map(item => item[1]),
                        backgroundColor: '#FF8042'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                maxRotation: 45
                            }
                        },
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // 운영 기관 유형별 분포 정보
            const 지자체수 = data.operatingAgencies.filter(([name]) => 
                name.includes('시') || name.includes('군') || name.includes('구') || name === '경기도'
            ).length;
            const 공사공단수 = data.operatingAgencies.filter(([name]) => 
                name.includes('공사') || name.includes('공단')
            ).length;
            const 전문기관수 = data.operatingAgencies.filter(([name]) => 
                name.includes('진흥') || name.includes('테크노파크') || name.includes('재단')
            ).length;
            const 기타수 = data.operatingAgencies.length - 지자체수 - 공사공단수 - 전문기관수;

            document.getElementById('operatingTypeInfo').innerHTML = `
                <div class="p-4 bg-blue-50 rounded-lg">
                    <h3 class="font-bold text-blue-800 mb-2">지방자치단체</h3>
                    <p class="text-blue-600">직접 운영하는 지자체가 다수를 차지합니다.</p>
                    <div class="text-2xl font-bold text-blue-800 mt-2">${지자체수}개 기관</div>
                </div>
                <div class="p-4 bg-green-50 rounded-lg">
                    <h3 class="font-bold text-green-800 mb-2">공사/공단</h3>
                    <p class="text-green-600">도시개발공사, 주택도시공사 등 공공기관입니다.</p>
                    <div class="text-2xl font-bold text-green-800 mt-2">${공사공단수}개 기관</div>
                </div>
                <div class="p-4 bg-purple-50 rounded-lg">
                    <h3 class="font-bold text-purple-800 mb-2">전문기관</h3>
                    <p class="text-purple-600">테크노파크, 진흥원 등 전문 운영기관입니다.</p>
                    <div class="text-2xl font-bold text-purple-800 mt-2">${전문기관수}개 기관</div>
                </div>
                ${기타수 > 0 ? `
                <div class="p-4 bg-gray-50 rounded-lg">
                    <h3 class="font-bold text-gray-800 mb-2">기타</h3>
                    <p class="text-gray-600">기타 운영기관입니다.</p>
                    <div class="text-2xl font-bold text-gray-800 mt-2">${기타수}개 기관</div>
                </div>
                ` : ''}
            `;
        }

        function renderOperatingTable() {
            const tbody = document.getElementById('operatingTableBody');
            tbody.innerHTML = data.operatingAgencies.map(([name, count], index) => {
                let type = '기타';
                if (name.includes('시') || name.includes('군') || name.includes('구') || name === '경기도') {
                    type = '지자체';
                } else if (name.includes('공사') || name.includes('공단')) {
                    type = '공사/공단';
                } else if (name.includes('진흥') || name.includes('테크노파크') || name.includes('재단')) {
                    type = '전문기관';
                }
                
                const typeClass = type === '지자체' ? 'bg-blue-100 text-blue-800' :
                               type === '공사/공단' ? 'bg-green-100 text-green-800' :
                               type === '전문기관' ? 'bg-purple-100 text-purple-800' :
                               'bg-gray-100 text-gray-800';
                
                return `<tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-2 px-3">${index + 1}</td>
                    <td class="py-2 px-3">${name}</td>
                    <td class="text-right py-2 px-3 font-medium">${count}개</td>
                    <td class="text-center py-2 px-3">
                        <span class="px-2 py-1 rounded-full text-xs ${typeClass}">${type}</span>
                    </td>
                </tr>`;
            }).join('');
        }

        function renderTimelineCharts() {
            // 연도별 AI 서비스 도입 추이 (라인 차트)
            if (charts.timelineChart) charts.timelineChart.destroy();
            const ctx1 = document.getElementById('timelineChart').getContext('2d');
            charts.timelineChart = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: data.yearData.map(item => item[0]),
                    datasets: [{
                        label: '서비스 수',
                        data: data.yearData.map(item => item[1]),
                        borderColor: '#00C49F',
                        backgroundColor: 'rgba(0, 196, 159, 0.1)',
                        borderWidth: 4,
                        pointRadius: 8,
                        pointBackgroundColor: '#00C49F'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // 연도별 상세 현황 (막대 차트)
            if (charts.timelineBarChart) charts.timelineBarChart.destroy();
            const ctx2 = document.getElementById('timelineBarChart').getContext('2d');
            charts.timelineBarChart = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: data.yearData.map(item => item[0]),
                    datasets: [{
                        label: '서비스 수',
                        data: data.yearData.map(item => item[1]),
                        backgroundColor: '#8884D8'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function renderYearAnalysis() {
            const maxCount = Math.max(...data.yearData.map(([,count]) => count));
            document.getElementById('yearAnalysis').innerHTML = data.yearData.map(([year, count], index) => {
                const prevCount = index > 0 ? data.yearData[index - 1][1] : 0;
                const growth = prevCount > 0 ? ((count - prevCount) / prevCount * 100).toFixed(1) : 0;
                const growthText = index > 0 ? 
                    `<span class="${growth > 0 ? 'text-green-600' : growth < 0 ? 'text-red-600' : 'text-gray-600'}">
                        ${growth > 0 ? '+' : ''}${growth}% 증감
                    </span>` : '';
                
                return `<div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                    <div>
                        <span class="font-bold text-lg">${year}년</span>
                        <div class="text-sm text-gray-600">${growthText}</div>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold text-blue-600">${count}개</div>
                        <div class="w-24 bg-gray-200 rounded-full h-2 mt-1">
                            <div class="bg-blue-500 h-2 rounded-full" style="width: ${(count / maxCount) * 100}%"></div>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        function renderTargetCharts() {
            // 서비스 대상별 분포 (원형 차트)
            if (charts.targetPieChart) charts.targetPieChart.destroy();
            const ctx1 = document.getElementById('targetPieChart').getContext('2d');
            charts.targetPieChart = new Chart(ctx1, {
                type: 'pie',
                data: {
                    labels: data.targets.map(item => item[0]),
                    datasets: [{
                        data: data.targets.map(item => item[1]),
                        backgroundColor: COLORS
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });

            // 서비스 대상별 현황 (막대 차트)
            if (charts.targetBarChart) charts.targetBarChart.destroy();
            const ctx2 = document.getElementById('targetBarChart').getContext('2d');
            charts.targetBarChart = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: data.targets.map(item => item[0]),
                    datasets: [{
                        label: '서비스 수',
                        data: data.targets.map(item => item[1]),
                        backgroundColor: '#FFC658'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                maxRotation: 45
                            }
                        },
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function renderTargetDetails() {
            const maxCount = Math.max(...data.targets.map(([,count]) => count));
            document.getElementById('targetDetails').innerHTML = data.targets.map(([name, count]) => 
                `<div class="p-4 border border-gray-200 rounded-lg hover:shadow-md transition-shadow">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-blue-600 mb-2">${count}개</div>
                        <div class="text-sm font-medium text-gray-700">${name}</div>
                        <div class="mt-2 w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-blue-500 h-2 rounded-full" style="width: ${(count / maxCount) * 100}%"></div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">${((count / data.total) * 100).toFixed(1)}%</div>
                    </div>
                </div>`
            ).join('');
        }
    </script>
</body>
</html>
